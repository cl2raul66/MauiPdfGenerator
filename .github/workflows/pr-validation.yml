name: PR Validation

permissions:
  contents: read
  
on:
  pull_request:
    branches: [ "development", "master" ]
    paths:
      - 'MauiPdfGenerator/**'
      - 'MauiPdfGenerator.Diagnostics/**'
      - 'MauiPdfGenerator.SourceGenerators/**'
  workflow_dispatch:

jobs:
  validate-solution:
    name: Build & Test All
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '10.0.x' 
      
      - name: Install MAUI Workloads
        run: dotnet workload install maui --ignore-failed-sources

      - name: Build All Projects
        run: |
          dotnet build MauiPdfGenerator.sln --configuration Debug

      - name: Run Unit Tests (Core)
        run: dotnet test MauiPdfGenerator.Tests/MauiPdfGenerator.Tests.csproj --configuration Release --no-build --verbosity normal

      - name: Run Unit Tests (Diagnostics)
        run: dotnet test MauiPdfGenerator.Diagnostics.Tests/MauiPdfGenerator.Diagnostics.Tests.csproj --configuration Release --no-build --verbosity normal

      - name: Run Unit Tests (SourceGen)
        run: dotnet test MauiPdfGenerator.SourceGenerators.Tests/MauiPdfGenerator.SourceGenerators.Tests.csproj --configuration Release --no-build --verbosity normal

      - name: Run Integration Tests
        run: dotnet test MauiPdfGenerator.IntegrationTests/MauiPdfGenerator.IntegrationTests.csproj --configuration Release --no-build --verbosity normal
